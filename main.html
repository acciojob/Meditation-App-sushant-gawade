<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Meditation App</title>
  <style>
    /* Basic reset */
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif}
    body{display:flex;align-items:center;justify-content:center;background:#111;color:#fff}

    /* App container (global id required) */
    #app{width:100%;height:100vh;position:relative;overflow:hidden}

    /* Video container */
    .vid-container{position:absolute;inset:0}
    .vid-container video{width:100%;height:100%;object-fit:cover}

    /* Controls area centered */
    .controls{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none}
    .player{pointer-events:auto;display:flex;flex-direction:column;align-items:center;gap:18px}

    /* Circular timer */
    .progress-wrap{width:360px;height:360px;display:flex;align-items:center;justify-content:center;position:relative}
    svg{transform:rotate(-90deg)}
    .outline{fill:none;stroke:#fff;stroke-width:12;opacity:0.95}
    .moving{fill:none;stroke:#2fb6d7;stroke-width:12;stroke-linecap:round;transition:stroke-dashoffset 0.3s linear}

    /* Play button */
    .play{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:88px;height:88px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:transparent;border:none;cursor:pointer;pointer-events:auto}
    .play svg{width:56px;height:56px}

    /* Small restart icon at bottom of circle (not required but added) */
    .restart{position:absolute;bottom:14%;left:50%;transform:translateX(-50%)}

    /* Time display */
    .time-display{font-size:56px;font-weight:600;margin-top:10px;text-align:center}

    /* Left time-select buttons */
    #time-select{position:absolute;left:40px;top:50%;transform:translateY(-50%);display:flex;flex-direction:column;gap:40px;pointer-events:auto}
    #time-select button{background:transparent;border:2px solid rgba(255,255,255,0.6);padding:16px 28px;border-radius:8px;color:#fff;font-size:18px;cursor:pointer}

    /* Right sound-picker */
    .sound-picker{position:absolute;right:40px;top:50%;transform:translateY(-50%);display:flex;flex-direction:column;gap:32px;pointer-events:auto}
    .sound-picker button{width:88px;height:88px;border-radius:999px;border:none;display:flex;align-items:center;justify-content:center;cursor:pointer}
    .sound-picker .a{background:#3b82f6}
    .sound-picker .b{background:#b45309}

    /* Player container for audio elements (hidden) */
    .player-container{display:none}

    /* Responsive scaling */
    @media (max-width:900px){
      .progress-wrap{width:260px;height:260px}
      .time-display{font-size:36px}
    }
  </style>
</head>
<body>
  <div id="app">

    <!-- VIDEO -->
    <div class="vid-container">
      <!-- default video (beach) -->
      <video id="vid" loop muted playsinline>
        <source src="video/beach.mp4" type="video/mp4">
      </video>
    </div>

    <!-- Controls overlay -->
    <div class="controls">
      <div class="player">

        <div class="progress-wrap">
          <!-- svg circle for progress -->
          <svg width="360" height="360" viewBox="0 0 100 100">
            <circle class="outline" cx="50" cy="50" r="40"></circle>
            <circle class="moving" cx="50" cy="50" r="40" stroke-dasharray="251.2" stroke-dashoffset="0"></circle>
          </svg>

          <!-- Play/Pause button -->
          <button class="play" aria-label="play">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M8 5v14l11-7L8 5z" fill="#ffffff"/>
            </svg>
          </button>

        </div>

        <div class="time-display">10:0</div>
      </div>
    </div>

    <!-- Left time pick (id time-select) -->
    <div id="time-select">
      <button id="smaller-mins">2 Minutes</button>
      <button id="medium-mins">5 Minutes</button>
      <button id="long-mins">10 Minutes</button>
    </div>

    <!-- Right sound picker -->
    <div class="sound-picker">
      <button class="a" data-sound="Sounds/beach.mp3" data-video="video/beach.mp4" title="Meditation A"></button>
      <button class="b" data-sound="Sounds/rain.mp3" data-video="video/rain.mp4" title="Meditation B"></button>
    </div>

    <!-- Hidden audio players container -->
    <div class="player-container">
      <audio id="audio" src="Sounds/beach.mp3" preload="auto"></audio>
    </div>

  </div>

  <script>
    // Element references
    const app = document.getElementById('app');
    const audio = document.getElementById('audio');
    const video = document.getElementById('vid');
    const playBtn = document.querySelector('.play');
    const timeDisplay = document.querySelector('.time-display');
    const moving = document.querySelector('.moving');
    const outline = document.querySelector('.outline');

    // time buttons
    const smaller = document.getElementById('smaller-mins');
    const medium = document.getElementById('medium-mins');
    const longer = document.getElementById('long-mins');

    // sound picker buttons
    const soundBtns = document.querySelectorAll('.sound-picker button');

    // timer state
    let fakeDuration = 600; // default 10 minutes (seconds)
    let timeLeft = fakeDuration;
    let isPlaying = false;
    let timerInterval = null;

    // circle length (r=40 => circumference = 2*pi*40 ~ 251.2). Use same as stroke-dasharray in HTML
    const outlineLength = 2 * Math.PI * 40;
    moving.style.strokeDasharray = outlineLength;
    moving.style.strokeDashoffset = outlineLength; // initially full offset (empty progress)

    // utility: format seconds into M:S or M:SS per instruction initial 10:0
    function formatTime(s) {
      const m = Math.floor(s / 60);
      const sec = s % 60;
      // keep "10:0" style for whole seconds like example
      return sec === 0 ? `${m}:0` : `${m}:${sec.toString().padStart(2,'0')}`;
    }

    // initialize display
    timeLeft = fakeDuration;
    timeDisplay.textContent = formatTime(timeLeft);

    function startTimer() {
      // play audio and video
      audio.play();
      video.play();
      isPlaying = true;
      playBtn.setAttribute('aria-label','pause');

      // clear old interval
      if (timerInterval) clearInterval(timerInterval);

      const start = Date.now();
      const endTime = Date.now() + timeLeft * 1000;

      timerInterval = setInterval(()=>{
        const now = Date.now();
        const remainingMs = Math.max(0, endTime - now);
        timeLeft = Math.ceil(remainingMs / 1000);

        // update display
        timeDisplay.textContent = formatTime(timeLeft);

        // update circle progress
        const elapsed = fakeDuration - timeLeft;
        const progress = elapsed / fakeDuration; // 0..1
        moving.style.strokeDashoffset = Math.max(0, outlineLength - (outlineLength * progress));

        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          timerInterval = null;
          isPlaying = false;
          audio.pause();
          audio.currentTime = 0;
          video.pause();
          video.currentTime = 0;
          playBtn.innerHTML = `<svg viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M8 5v14l11-7L8 5z\" fill=\"#ffffff\"/></svg>`;
          timeLeft = fakeDuration;
          timeDisplay.textContent = formatTime(timeLeft);
          moving.style.strokeDashoffset = outlineLength;
        }
      }, 250);
    }

    function pauseTimer(){
      if (timerInterval) { clearInterval(timerInterval); timerInterval = null }
      audio.pause();
      video.pause();
      isPlaying = false;
      playBtn.setAttribute('aria-label','play');
    }

    // play button toggle
    playBtn.addEventListener('click',()=>{
      if (!isPlaying) {
        // if audio/video were at start and timeLeft==fakeDuration, ensure media starts at 0
        if (audio.currentTime === 0 && video.currentTime === 0 && timeLeft === fakeDuration) {
          // ok
        }
        startTimer();
        // visual: change play icon to pause
        playBtn.innerHTML = `<svg viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><rect x=\"6\" y=\"5\" width=\"4\" height=\"14\" fill=\"#fff\"></rect><rect x=\"14\" y=\"5\" width=\"4\" height=\"14\" fill=\"#fff\"></rect></svg>`;
      } else {
        pauseTimer();
        playBtn.innerHTML = `<svg viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M8 5v14l11-7L8 5z\" fill=\"#ffffff\"/></svg>`;
      }
    });

    // time select buttons
    smaller.addEventListener('click', ()=>{
      setDuration(2*60);
    });
    medium.addEventListener('click', ()=>{
      setDuration(5*60);
    });
    longer.addEventListener('click', ()=>{
      setDuration(10*60);
    });

    function setDuration(seconds){
      fakeDuration = seconds;
      // reset timer
      if (timerInterval) { clearInterval(timerInterval); timerInterval = null }
      audio.pause(); audio.currentTime = 0;
      video.pause(); video.currentTime = 0;
      isPlaying = false;
      playBtn.innerHTML = `<svg viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M8 5v14l11-7L8 5z\" fill=\"#ffffff\"/></svg>`;
      moving.style.strokeDashoffset = outlineLength;
      timeLeft = fakeDuration;
      timeDisplay.textContent = formatTime(timeLeft);
    }

    // sound picker
    soundBtns.forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const soundSrc = btn.dataset.sound;
        const videoSrc = btn.dataset.video;
        // switch audio and video sources
        audio.src = soundSrc;
        video.querySelectorAll('source').forEach(s=>s.src = videoSrc);
        // reload media
        audio.load();
        video.load();
        // if currently playing, restart play with new sources
        if (isPlaying) {
          audio.play();
          video.play();
        }
      });
    });

    // allow clicking on vid-container to toggle mute/unmute for demo
    document.querySelector('.vid-container').addEventListener('click',()=>{
      // toggle muted; audio element still controls sound, this eases debugging on some browsers
      video.muted = !video.muted;
    });

    // ensure media paused at start
    audio.pause();
    video.pause();
  </script>
</body>
</html>
